# MARS: Multi-Repository Data Submission

## Introduction
MARS is a data brokering system for submitting multi-omics life sciences studies to multiple specialized repositories.
MARS is a versatile and modular Multi-Repository ISA Submission Framework that enables data producers and multiple data repositories to exchange information seamlessly using the same standardized ISA-JSON format. Unlike a centralized platform, MARS operates as a common framework, allowing for decentralized data submissions while ensuring consistent interpretation and validation of ISA-JSON containing metadata across various repositories.
MARS serves as a common ground where data producers and diverse data repositories can interact cohesively, sharing scientific metadata encoded in ISA-JSON format. The framework ensures mutual understanding and accurate interpretation of the data, preserving the important links between multi-omics data generated from the same biological source.

## Components in MARS
MARS is comprised of distinct components, each representing key roles in the data submission process. Together, they form the essential building blocks of MARS, enabling cohesive and reliable data submission to multiple repositories.
Each role performs specific functions and carries distinct responsibilities essential for the smooth operation of the system.

### ISA-JSON producers
This role includes research infrastructure or service facilities that operate platforms such as ARC, FAIRDOM-SEEK, ISA Creators or any other tool that generates ISA-JSON files.
* Function: Prepare research data in ISA-JSON format, generate and export ISA-JSON files.
* Responsibilities:
  * Ensure compatibility of the exported ISA-JSON files with the format expected by MARS.
  * Support and validate for the use of repositoriesâ€™ checklists, controlled vocabulary, ontology terms, and other required metadata.
 
### Data broker
This role includes research infrastructure or service facilities that operate a platform designed to streamline the data submission process to repositories. This platform serves as intermediary in MARS, facilitating seamless and efficient submission of data to various repositories. Data brokers play a vital role in ensuring the smooth flow of information within the system, connecting data producers with repositories effectively and securely
* Functions:
  * access to the metadata and data files, orchestrates the pairing of data and metadata,  
The data broker can have an ENA brokering account or not. The data brokering tool or service can be used with a personal account for data repositories.
Data broker reads receipts generated by the repositories and add the information into the ISA-JSON.

## Diagram
````mermaid
graph TD
    start((START)) --> ISA-JSON
    style start fill:#FFFFFF,stroke:#333,stroke-width:5px
    inform --> endNode{{END}}
    style endNode fill:#E0E0E0,stroke:#333,stroke-width:5px
    subgraph User/JSON Producer
        targetRepo(Define Target repositories) -->|Add comment to ISA| ISA-JSON
        ISA-JSON
        Credentials
        Files
        Files --> |Addition\nof Checksums| ISA-JSON
        fix(Fix error)
        style fix fill:#FF9999,stroke:#333,stroke-width:2px
        inform(Retrieve extended ISA-JSON)
    end

    subgraph Broker platform
        ISA-JSON --> |Upload| isa[ISA-JSON]
        Credentials --> |Upload| credentials[Credentials]
        Files --> |??????| files[Files]
        isa --> validation{Validate\nISA-JSON}
        validation --> |No| fix
        validation --> |Yes| sendIsa(API call)
        style sendIsa fill:#F5F906,stroke:#333,stroke-width:2px
        credentials --> sendIsa
        updatedIsa[Updated ISA-JSON]
        updatedIsa --> sendIsa2(API call)
        style sendIsa2 fill:#F5F906,stroke:#333,stroke-width:2px
        credentials --> sendIsa2
        files --> sendIsa2
        responseDec2 --> |Yes: Extend\nISA-JSON|updatedIsa2
        updatedIsa2[Updated ISA-JSON]
        updatedIsa2 --> extensionBS(Download BioSamples JSON &\nExtend External References)
        extensionBS --> sendIsaBsFinal(API call)
        responseDec1{Correct\nResponse}
        responseDec1 --> |Yes: Extend\nISA-JSON|updatedIsa 
        responseDec1 --> |No| fix
        responseDec2{Correct\nResponse}
        responseDec2 --> |No| fix
        style sendIsaBsFinal fill:#F5F906,stroke:#333,stroke-width:2px
    end

    subgraph BioSamples
        sendIsa --> |Send ISA-JSON| readIsa(Read and Transform ISA-JSON)
        readIsa --> registerBs(Register BioSamples)
        registerBs --> checkBS{Correct\nsubmission}
        checkBS -->|Yes| receipt1[Response with\nBioSample accessions]
        checkBS -->|No| receipt1no[Response with\nerrors]
        receipt1no --> |Send| responseDec1
        style receipt1no fill:#FF9999,stroke:#333,stroke-width:2px
        receipt1 --> |Send| responseDec1
        sendIsaBsFinal --> |Resubmission as \nModification| modifyBiosamples(Modify existing BioSamples)
        modifyBiosamples --> inform
        style BioSamples fill:#92FBA9,stroke:#333,stroke-width:2px,stroke-dasharray: 5, 5
    end

    subgraph Archives
        sendIsa2 --> g_read(Read and Transform ISA-JSON)
        g_read --> g_register(Register objects)
        g_register --> g_check{Correct\nsubmission}
        g_check -->|Yes| g_receipt[Response with\nArchived accessions]
        g_check -->|No| g_receiptno[Response with\nerrors]
        g_receiptno --> |Send| responseDec2
        style g_receiptno fill:#FF9999,stroke:#333,stroke-width:2px
        g_receipt --> |Send| responseDec2
        updatedIsa2
        style Archives fill:#3BF9F9,stroke:#333,stroke-width:2px,stroke-dasharray: 5, 5
    end

    subgraph ArchiveList
        ENA
        MetaboLights
    end

    ArchiveList -.- Archives
````
